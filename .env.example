# Firestore Configuration
# GCP project ID for Firestore operations
# REQUIRED: Set this to your Google Cloud Platform project ID
# Example: FIRESTORE_PROJECT_ID=my-gcp-project-123
FIRESTORE_PROJECT_ID=your-gcp-project-id

# Path to GCP service account credentials JSON file
# REQUIRED for local development: Download your service account key from GCP Console
# For Cloud Run deployment: This can be omitted as Cloud Run uses workload identity
# Example: GOOGLE_APPLICATION_CREDENTIALS=/path/to/service-account-key.json
GOOGLE_APPLICATION_CREDENTIALS=/path/to/service-account-key.json

# Service Configuration
# Port for the service (default: 8080, valid range: 1-65535)
# Cloud Run automatically sets this to 8080, no need to override in Cloud Run
PORT=8080

# Service name for logging and identification
# Used in structured logs for service identification
SERVICE_NAME=plan-scheduler

# Logging Configuration
# Logging level for the application
# Valid values: DEBUG, INFO, WARNING, ERROR, CRITICAL
# Invalid values will fall back to INFO with a warning
# Default: INFO
LOG_LEVEL=INFO

# Runtime Configuration
# Number of uvicorn worker processes (default: 1, valid range: 1-16)
# For Cloud Run, 1-2 workers is recommended. Cloud Run scales horizontally via container instances.
# Higher worker counts increase memory usage but improve concurrent request handling.
# Default: 1
WORKERS=1

# Pub/Sub Configuration
# 
# Authentication for Pub/Sub push requests uses two methods:
# 1. OIDC JWT verification (recommended for production)
# 2. Shared token verification (fallback or legacy mode)

# Enable OIDC JWT verification for Pub/Sub push requests
# When enabled, the service validates Google-signed JWT tokens from Authorization header
# Falls back to shared token if OIDC validation fails or is disabled
# Default: true (enabled)
PUBSUB_OIDC_ENABLED=true

# Expected audience claim in OIDC JWT tokens
# REQUIRED when PUBSUB_OIDC_ENABLED is true
# Set this to your Cloud Run service URL
# Example: PUBSUB_EXPECTED_AUDIENCE=https://plan-scheduler-abc123-uc.a.run.app
PUBSUB_EXPECTED_AUDIENCE=https://your-service-url

# Expected issuer claim in OIDC JWT tokens
# Default: https://accounts.google.com (Google's service account issuer)
# Only change if using custom token issuer
PUBSUB_EXPECTED_ISSUER=https://accounts.google.com

# Expected service account email in JWT subject claim
# Optional but recommended for enhanced security
# Should match the Pub/Sub push subscription service account
# Example: PUBSUB_SERVICE_ACCOUNT_EMAIL=pubsub-invoker@my-project.iam.gserviceaccount.com
PUBSUB_SERVICE_ACCOUNT_EMAIL=

# Shared token verification (fallback mode)
# Used when OIDC is disabled or validation fails
# REQUIRED when PUBSUB_OIDC_ENABLED is false
# This token should match what is configured in your Pub/Sub push subscription
# and will be sent by Pub/Sub in the 'x-goog-pubsub-verification-token' header
# 
# Security Note: Generate a strong, random token and store it securely.
# For Cloud Run: Store this in Secret Manager and inject as an environment variable
# For local development: Generate with: python -c "import secrets; print(secrets.token_urlsafe(32))"
#
# Example of a strong random token (DO NOT use this exact value in production):
# PUBSUB_VERIFICATION_TOKEN=J7ZigtqyXkbATeElXULwz-3Lu1F3q6yJ-8dpBkwBMLU
PUBSUB_VERIFICATION_TOKEN=your-verification-token

# Execution Service Configuration
# Enable or disable execution service triggers
# When disabled, plan ingestion will persist to Firestore but NOT trigger execution.
# Useful for testing, maintenance, or when using external orchestration.
# Default: true (enabled)
EXECUTION_ENABLED=true

# External Execution API Configuration (Optional)
# Base URL for external execution API
# Leave empty if not using external execution service
# Example: EXECUTION_API_URL=https://execution-service.example.com
# EXECUTION_API_URL=

# API key for external execution service authentication
# Leave empty if not using external execution service
# For production: Store in Secret Manager and inject as environment variable
# EXECUTION_API_KEY=
